name: Test

inputs:
  target:
    default: "dissolve"

runs:
  using: "composite"
  steps:

  - name: Install nix
    uses: "./.github/workflows/get-nix"
    with:
      target: ${{ inputs.target }}

  - name: Test
    shell: bash
    run: |
      set -ex

      source ~/.nix-profile/etc/profile.d/nix.sh

      # Build
      nix build -L .#checks.x86_64-linux.${{ inputs.target }}
      nix build --json .#checks.x86_64-linux.${{ inputs.target }} > archive.json
