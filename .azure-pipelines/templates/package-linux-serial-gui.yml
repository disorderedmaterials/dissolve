parameters:
  - name: qtver
    default: 512

steps:
  - bash: |
      set -ex
      # Set environment vars
      QT_BASE_DIR="/opt/qt${{ parameters.qtver }}"
      export QTDIR=$QT_BASE_DIR
      export PATH=$QT_BASE_DIR/bin:$PATH
      # Prep appimage directories
      ci/scripts/prep-appimage -a Dissolve -v continuous -b build/bin/dissolve
      ci/scripts/prep-appimage -a Dissolve-GUI -v continuous -b build/bin/dissolve-gui
      # Retrieve linuxdeployqt
      echo -e "\nRetrieving linuxdeployqt...\n"
      wget -q https://github.com/probonopd/linuxdeployqt/releases/download/continuous/linuxdeployqt-continuous-x86_64.AppImage -O linuxdeployqt
      chmod u+x ./linuxdeployqt
      # Run on the targets
      ./linuxdeployqt Dissolve-continuous.AppDir/usr/share/applications/*.desktop -appimage
      ./linuxdeployqt Dissolve-GUI-continuous.AppDir/usr/share/applications/*.desktop -appimage
      # Store artifacts
      mkdir packages
      mv Dissolve-*-x86_64.AppImage packages
    displayName: 'Create AppImages'
